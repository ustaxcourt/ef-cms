import { GENERATION_TYPES } from '@web-client/getConstants';
import { state } from '@web-client/presenter/app.cerebral';

export const setDocumentFileForAutoGeneratedEntryOfAppearanceAction = async ({
  get,
  store,
}: ActionProps) => {
  const primaryDocumentFile = get(state.form.primaryDocumentFile);
  const pdfPreviewUrl = get(state.pdfPreviewUrl);
  const generationType = get(state.form.generationType);
  store.set(state.fileUploadProgress.isUploading, true);
  if (pdfPreviewUrl && generationType === GENERATION_TYPES.AUTO) {
    const file = await fetch(pdfPreviewUrl).then(async response => {
      const blob = await response.blob();
      return new File(
        [blob],
        primaryDocumentFile ? primaryDocumentFile.name : 'file.pdf',
        {
          type: blob.type,
        },
      );
    });
    store.set(state.form.primaryDocumentFile, file);
  }
};
