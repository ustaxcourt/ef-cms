FROM cypress/base:16.17.1

WORKDIR /home/app

RUN sh -c 'echo "deb [check-valid-until=no] http://ftp.debian.org/debian stretch-backports main" > /etc/apt/sources.list.d/stretch-backports.list'
RUN sed -i '/deb http:\/\/deb.debian.org\/debian stretch-backports main/d' /etc/apt/sources.list
RUN apt-get -o Acquire::Check-Valid-Until=false update

RUN apt-get install -y \
  graphicsmagick=1.4+really1.3.35-1~deb10u1

# Install secondary if primary does not work
RUN apt-get install -y \
  ghostscript=9.27~dfsg-2+deb10u5 \
  || apt-get install -y \
  ghostscript=9.27~dfsg-2+deb10u6

RUN apt-get install -y chromium

RUN apt-get install -y build-essential

RUN apt-get install -y libcairo2-dev libpango1.0-dev libjpeg-dev libgif-dev librsvg2-dev

ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true \
    PUPPETEER_SKIP_DOWNLOAD=true \
    PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium

COPY . /home/app/efcms

CMD echo "ðŸ”¥"
